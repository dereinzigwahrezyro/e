<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>2FA | ZYRO.LOL</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html, body {
    margin: 0;
    background: #000;
    font-family: "Courier New", monospace;
    color: #fff;
    text-align: center;
}

/* RAINBOW */
@keyframes rainbow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* LOGO */
pre {
    margin-top: 60px;
    font-size: 16px;
    line-height: 1.1;
    background: linear-gradient(
        90deg,
        red, orange, yellow, lime, cyan, blue, violet
    );
    background-size: 600% 600%;
    animation: rainbow 6s linear infinite;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* CONTAINER */
.container {
    margin-top: 40px;
}

/* ROUND INPUT */
input {
    width: 280px;
    padding: 14px;
    border-radius: 30px;
    border: 1px solid #333;
    background: #111;
    color: #fff;
    text-align: center;
    font-size: 14px;
    outline: none;
}

/* BUTTON */
button {
    margin-top: 15px;
    padding: 10px 25px;
    border-radius: 20px;
    border: none;
    cursor: pointer;
    background: #222;
    color: #fff;
    font-family: inherit;
}

button:hover {
    background: #333;
}

/* CODE DISPLAY */
.code {
    margin-top: 30px;
    font-size: 36px;
    letter-spacing: 4px;
}

.copy-btn {
    margin-top: 10px;
}
</style>
</head>

<body>

<pre>
 ____  _  _  ____   __     __     __   __
(__  )( \/ )(  _ \ /  \   (  )   /  \ (  )
 / _/  )  /  )   /(  O )_ / (_/\(  O )/ (_/\
(____)(__/  (__\_) \__/(_)\____/ \__/ \____/
</pre>

<div class="container">
    <input id="secret" placeholder="Enter 16 digit key">

    <br>

    <button onclick="generate()">Generate Code</button>

    <div class="code" id="code">------</div>

    <button class="copy-btn" onclick="copyCode()">Copy</button>
</div>

<script>
function base32ToBytes(base32) {
    const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
    let bits = "";
    let bytes = [];

    base32 = base32.replace(/=+$/, "").toUpperCase().replace(/\s+/g,'');

    for (let i = 0; i < base32.length; i++) {
        const val = alphabet.indexOf(base32[i]);
        if (val === -1) return null;
        bits += val.toString(2).padStart(5, "0");
    }

    for (let i = 0; i + 8 <= bits.length; i += 8) {
        bytes.push(parseInt(bits.substring(i, i + 8), 2));
    }

    return new Uint8Array(bytes);
}

async function generate() {
    const secret = document.getElementById("secret").value.trim();
    const codeEl = document.getElementById("code");

    if (secret.length < 16) {
        codeEl.textContent = "Invalid";
        return;
    }

    const keyBytes = base32ToBytes(secret);
    if (!keyBytes) {
        codeEl.textContent = "Invalid";
        return;
    }

    const epoch = Math.floor(Date.now() / 1000);
    const counter = Math.floor(epoch / 30);

    const buffer = new ArrayBuffer(8);
    const view = new DataView(buffer);
    view.setUint32(4, counter);

    const cryptoKey = await crypto.subtle.importKey(
        "raw",
        keyBytes,
        { name: "HMAC", hash: "SHA-1" },
        false,
        ["sign"]
    );

    const signature = await crypto.subtle.sign("HMAC", cryptoKey, buffer);
    const hmac = new Uint8Array(signature);

    const offset = hmac[hmac.length - 1] & 0xf;

    const binary =
        ((hmac[offset] & 0x7f) << 24) |
        ((hmac[offset + 1] & 0xff) << 16) |
        ((hmac[offset + 2] & 0xff) << 8) |
        (hmac[offset + 3] & 0xff);

    const otp = (binary % 1000000).toString().padStart(6, "0");
    codeEl.textContent = otp;
}

function copyCode() {
    const code = document.getElementById("code").textContent;
    if (code === "------" || code === "Invalid") return;
    navigator.clipboard.writeText(code);
}
</script>

</body>
</html>
