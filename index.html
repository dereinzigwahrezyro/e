<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>2FA | ZYRO.LOL</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html, body {
    margin: 0;
    height: 100%;
    background: #000;
    font-family: "Courier New", monospace;
    color: #fff;
}

.wrapper {
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}

.container {
    text-align: center;
}

/* RAINBOW */
@keyframes rainbow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* LOGO */
pre {
    font-size: 16px;
    margin-bottom: 30px;
    background: linear-gradient(
        90deg,
        red, orange, yellow, lime, cyan, blue, violet
    );
    background-size: 600% 600%;
    animation: rainbow 6s linear infinite;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* INPUT */
input {
    width: 260px;
    padding: 14px;
    border-radius: 30px;
    border: 1px solid #333;
    background: #111;
    color: #fff;
    text-align: center;
    font-size: 14px;
    outline: none;
    margin-bottom: 20px;
}

/* CODE */
.code {
    font-size: 40px;
    letter-spacing: 6px;
    margin-top: 20px;
}

/* TIMER */
.timer {
    margin-top: 10px;
    color: #aaa;
}

.progress {
    width: 260px;
    height: 6px;
    background: #111;
    border-radius: 4px;
    margin: 10px auto;
    overflow: hidden;
}

.bar {
    height: 100%;
    width: 100%;
    background: linear-gradient(
        90deg,
        red, orange, yellow, lime, cyan, blue, violet
    );
    background-size: 600% 600%;
    animation: rainbow 6s linear infinite;
}

/* COPY BUTTON */
.copy-btn {
    margin-top: 15px;
    padding: 10px 25px;
    border-radius: 20px;
    border: none;
    background: #333;
    color: #fff;
    cursor: pointer;
    font-family: inherit;
    transition: background .3s, color .3s;
}

.copy-btn.success {
    background: #00aa44;
}
</style>
</head>

<body>

<div class="wrapper">
<div class="container">

<pre>
 ____  _  _  ____   __     __     __   __
(__  )( \/ )(  _ \ /  \   (  )   /  \ (  )
 / _/  )  /  )   /(  O )_ / (_/\(  O )/ (_/\
(____)(__/  (__\_) \__/(_)\____/ \__/ \____/
</pre>

<input id="secret" placeholder="Enter 16 digit key" maxlength="16">

<div class="code" id="code">------</div>

<div class="progress">
    <div class="bar" id="bar"></div>
</div>

<div class="timer" id="timer">30s</div>

<button id="copyBtn" class="copy-btn">Copy Code</button>

</div>
</div>

<script>
let realSecret = "";

const input = document.getElementById("secret");
const codeEl = document.getElementById("code");
const timerEl = document.getElementById("timer");
const bar = document.getElementById("bar");
const copyBtn = document.getElementById("copyBtn");

/* MASK AFTER 16 CHARS */
input.addEventListener("input", () => {
    realSecret = input.value.replace(/\s+/g,'').toUpperCase();

    if (realSecret.length > 16) {
        realSecret = realSecret.slice(0,16);
    }

    if (realSecret.length === 16) {
        input.value = "*".repeat(16);
    }
});

/* BASE32 */
function base32ToBytes(base32) {
    const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
    let bits = "";
    let bytes = [];

    for (let i = 0; i < base32.length; i++) {
        const val = alphabet.indexOf(base32[i]);
        if (val === -1) return null;
        bits += val.toString(2).padStart(5, "0");
    }

    for (let i = 0; i + 8 <= bits.length; i += 8) {
        bytes.push(parseInt(bits.substring(i, i + 8), 2));
    }

    return new Uint8Array(bytes);
}

/* TOTP */
async function generateTOTP(secret) {
    const keyBytes = base32ToBytes(secret);
    if (!keyBytes) return "------";

    const epoch = Math.floor(Date.now() / 1000);
    const counter = Math.floor(epoch / 30);

    const buffer = new ArrayBuffer(8);
    const view = new DataView(buffer);
    view.setUint32(4, counter);

    const cryptoKey = await crypto.subtle.importKey(
        "raw",
        keyBytes,
        { name: "HMAC", hash: "SHA-1" },
        false,
        ["sign"]
    );

    const signature = await crypto.subtle.sign("HMAC", cryptoKey, buffer);
    const hmac = new Uint8Array(signature);

    const offset = hmac[hmac.length - 1] & 0xf;

    const binary =
        ((hmac[offset] & 0x7f) << 24) |
        ((hmac[offset + 1] & 0xff) << 16) |
        ((hmac[offset + 2] & 0xff) << 8) |
        (hmac[offset + 3] & 0xff);

    return (binary % 1000000).toString().padStart(6, "0");
}

/* UPDATE LOOP */
async function update() {
    if (realSecret.length === 16) {
        codeEl.textContent = await generateTOTP(realSecret);
    }

    const seconds = 30 - Math.floor(Date.now() / 1000) % 30;
    timerEl.textContent = seconds + "s";
    bar.style.width = (seconds / 30 * 100) + "%";
}

setInterval(update, 1000);

/* COPY BUTTON */
copyBtn.addEventListener("click", async () => {
    const code = codeEl.textContent;
    if (code === "------") return;

    await navigator.clipboard.writeText(code);

    copyBtn.textContent = "Code Copied!";
    copyBtn.classList.add("success");

    setTimeout(() => {
        copyBtn.textContent = "Copy Code";
        copyBtn.classList.remove("success");
    }, 2000);
});
</script>

</body>
</html>
